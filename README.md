# LooseRML

## 1. Before starting 

Before executing any command documented here, make sure to:
- install node.js (version?)
- clone this rep
- run `npm install`
- normalize the RML file using this repo:  
  [https://gitlab.ilabt.imec.be/rml/translation/normalize-rml](https://gitlab.ilabt.imec.be/rml/translation/normalize-rml)
  Below algorithms suppose that the RML file is normalized, e.g. no shortcuts as rr:subject, rr: object, rr:predicate.

In [./resources](./resources) examples are given in YARRRML and RML. The YARRRML examples are giving to improve readability, but cannot be input or output files for below scripts. The YARRRML files may contains more rdf:labels that the RML files. 

## 2. Temporary: Workaround Issue 199

Command line interface:
```
node workAroundIssue1999.js [path_to_rml_file]
```
Temporary solution until [https://github.com/RMLio/rmlmapper-java/issues/199](https://github.com/RMLio/rmlmapper-java/issues/199) is solved
- Input: normalized RML file
- Output: new RML file with additional TriplesMap for each join with ParentTripleMap == TripleMap and Child != Parent
- Effect: the knowledge graph generated by the output RML file will be in line with the Knowledge Graph expected by the RML spec. When using RMLMapper the input RML file can miss triples.  
- Example: 
```
node workAroundIssue199.js ./resources/exampleWorkAroundIssue199-input.ttl
```


## 3. Eliminate self-joins

Command line interface:
```
node eliminateSelfJoins.js [path_to_rml_file]
```
- Input: normalized RML file
- Output: new RML file where most self-joins are removed. A join will be replaced by a crafted URI when the source and the iterator of the logical source of the TriplesMap and its ParentTripleMap are identical and when the Child and the Parent are the same (if a JoinCondition is present) and when the Subject of the ParentTriplesMap is build with a Template. 
- Effect: the knowledge graph generated by the input RML file is identical to the one generated by the output RML file (supposing the workaround for Issue199 is also applied on the input file when using RMLMapper > this workaround is applied automatically when executing the script).
- Example: 
```
node eliminateSelfJoins.js ./resources/eliminateSelfJoins-input.ttl
```

## 4. Make loose RML

Command line interface:
```
node makeLooseRML.js [path_to_rml_file]
```
- Input: normalized RML file
- Output: new RML file where first most self-joins are removed (see 3), and afterwareds most joins are removed. A join will be replaced by a crafted URI when the Subject of the ParentTriplesMap is build with a Template and when this Template uses only references to the Parent. 
- Effect: the knowledge graph generated by the output RML file can contain more triples that the one generated by the input RML file, because referential integraty is not checked (supposing the workaround for Issue199 is also applied on the input file when using RMLMapper > this workaround is applied automatically when executing the script).
- Example: 
```
node makeLooseRML.js ./resources/makeLooseRML-input.ttl
```

## 5. Evaluation

The effect of the scripts eliminateSelfJoins.js and makeLooseRML.js have been evaluated using the [GTFS Bench](https://github.com/oeg-upm/gtfs-bench/). The resulting Knowledge Graph were compared to the Knowledge Graphs generated by Morph-KGC (using the original input RML file) and were identical. RMLMapper cannot generated any output using the original input RML file (timeout because of joins).    

| engine    | version                                 | average execution time in seconds   |
|-----------|-----------------------------------------|-------------------------------------|
| morph-kgc | gtfs-csv-01                             | 13                                  |
|           | gtfs-csv-01-no-self-joins               | 13                                  |
|           | gtfs-csv-01-loose                       | 12                                  |
|           | gtfs-csv-05                             | 20                                  |
|           | gtfs-csv-05-no-self-joins               | 23                                  |
|           | gtfs-csv-05-loose                       | 22                                  |
| mapper    | gtfs-csv-01                             | time out                            |
|           | gtfs-csv-01-no-self-joins               | 50                                  |
|           | gtfs-csv-01-loose                       | 6                                   |
|           | gtfs-csv-05                             | time out                            |
|           | gtfs-csv-05-no-self-joins               | 1122.5                              |
|           | gtfs-csv-05-loose                       | 18.5                                |




## Author
Els de Vleeschauwer
